<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Civic Signal - Community Reporting</title>
<style>
:root {
  --bg: #f7f8fa;
  --card: #fff;
  --accent: #007bff;
  --accent2: #facc15;
  --muted: #6b7280;
  --success: #22c55e;
  --danger: #ef4444;
  --shadow: rgba(0,0,0,0.1);
  --input-bg: #fff;
  --input-border: #d1d5db;
  --text: #1c1c1c;
}

body.dark-mode {
  --bg: #121212;
  --card: #1e1e1e;
  --accent: #4f9cf9;
  --accent2: #facc15;
  --muted: #aaaaaa;
  --success: #22c55e;
  --danger: #ef4444;
  --shadow: rgba(0,0,0,0.5);
  --input-bg: #2c2c2c;
  --input-border: #444;
  --text: #f5f5f5;
}

body {
  font-family: 'Segoe UI', sans-serif;
  margin:0;
  background:var(--bg);
  color:var(--text);
  transition: all 0.3s;
}

header {
  position: sticky;
  top:0;
  z-index:100;
  background:var(--accent);
  color:white;
  display:flex;
  justify-content: space-between;
  align-items:center;
  padding:15px 20px;
  box-shadow:0 4px 10px var(--shadow);
  border-bottom-left-radius:12px;
  border-bottom-right-radius:12px;
}

header h1 { margin:0; font-size:1.8rem; }

#profileBtn {
  width:50px;
  height:50px;
  border-radius:50%;
  background:linear-gradient(135deg,#f43f5e,#f59e0b);
  border:none;
  cursor:pointer;
  color:white;
  font-weight:bold;
  font-size:1rem;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
  margin-left:10px;
}

#profileBtn img { width:100%; height:100%; object-fit:cover; border-radius:50%; }

#modeToggle {
  cursor:pointer;
  font-size:1.5rem;
  margin-left:10px;
  color:white;
  background:none;
  border:none;
}

nav {
  display:flex;
  justify-content:center;
  background:var(--bg);
  padding:10px 0;
  gap:15px;
  box-shadow:0 2px 4px var(--shadow);
  flex-wrap:wrap;
}

.nav-btn {
  border:none;
  background:none;
  padding:10px 18px;
  cursor:pointer;
  border-radius:12px;
  font-weight:500;
  transition:all 0.2s;
  color:var(--text);
}

.nav-btn.active, .nav-btn:hover {
  background:var(--accent);
  color:white;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
}

main {
  display:flex;
  justify-content:center;
  gap:20px;
  padding:20px 30px;
}

.feed { flex:1; display:flex; flex-direction:column; gap:20px; }

.tab {
  display:none;
  background:var(--card);
  border-radius:12px;
  box-shadow:0 4px 12px var(--shadow);
  padding:25px;
  transition: all 0.3s;
}

.tab.active { display:block; }

h2,h3 { color:var(--accent); margin-bottom:10px; }

input, textarea, select {
  width:100%;
  margin-bottom:12px;
  padding:14px;
  border-radius:12px;
  border:1px solid var(--input-border);
  background:var(--input-bg);
  color:var(--text);
  outline:none;
  transition: all 0.2s;
}

input:focus, textarea:focus, select:focus {
  border-color:var(--accent);
  box-shadow:0 0 10px var(--accent2);
}

.btn {
  background:var(--accent);
  color:white;
  border:none;
  padding:12px 20px;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
  width:100%;
  margin-top:10px;
  transition: all 0.2s;
}

.btn:hover { transform:scale(1.03); box-shadow:0 6px 15px rgba(0,0,0,0.5); }

.issue-card {
  background:var(--card);
  border-radius:12px;
  box-shadow:0 6px 18px var(--shadow);
  padding:20px;
  transition:transform 0.2s, background 0.3s;
  border:1px solid var(--input-border);
}

.issue-card:hover { transform:scale(1.01); box-shadow:0 8px 20px var(--shadow); }

.issue-card img { max-width:100%; height:auto; border-radius:12px; margin-top:10px; object-fit:cover; }

.delete-btn { background:var(--danger); border:none; padding:8px 12px; border-radius:8px; cursor:pointer; color:white; margin-top:10px; font-weight:600; }

.comment { margin-top:10px; padding:10px; background:#2a2a2a; border-radius:8px; }

#map, #reportMap { width:100%; height:400px; border-radius:12px; margin-top:10px; box-shadow:0 4px 12px var(--shadow); }

footer {
  text-align:center;
  padding:20px;
  background:var(--accent);
  color:white;
  font-size:0.9rem;
  margin-top:30px;
  border-top-left-radius:12px;
  border-top-right-radius:12px;
}

#notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--success);
  color: white;
  padding: 15px 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  display: none;
  z-index: 9999;
}

@media (max-width:1024px){ main{ flex-direction:column; padding:15px; } }
</style>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>

<header>
  <h1>ðŸŒ† Civic Signal</h1>
  <div style="display:flex;align-items:center;">
    <button id="modeToggle" title="Toggle Dark/Light Mode">ðŸŒ™</button>
    <button id="profileBtn" title="Profile"></button>
  </div>
</header>

<nav>
  <button class="nav-btn active" data-tab="homeTab">Home</button>
  <button class="nav-btn" data-tab="reportTab">Report Issue</button>
  <button class="nav-btn" data-tab="issuesTab">View Issues</button>
  <button class="nav-btn" data-tab="mapTab">Map</button>
</nav>

<main>
  <div class="feed">
    <!-- HOME -->
    <section id="homeTab" class="tab active">
      <h2>Welcome to Civic Signal</h2>
      <p>Empowering citizens to report local issues and improve their community.</p>
      <h3>About Civic Signal</h3>
      <p>Civic Signal connects citizens with local government. Report broken streetlights, potholes, waste issues, and more.</p>
      <h3>Mission</h3>
      <p>Increase transparency, improve response time, and create better communities through citizen engagement.</p>
      <h3>Contact Us</h3>
      <p>Email: support@civicsignal.com<br>Phone: 09XXXXXXXXX<br>Address: 123 Community Lane, Your City</p>
    </section>

    <!-- REPORT -->
    <section id="reportTab" class="tab">
      <h2>Report an Issue</h2>
      <form id="reportForm">
        <input id="issueTitle" type="text" placeholder="Issue Title" required>
        <textarea id="issueDesc" placeholder="Describe the problem..." rows="4" required></textarea>
        <select id="issueCategory" required>
          <option value="">Select Category</option>
          <option value="Road">Road</option>
          <option value="Garbage">Garbage</option>
          <option value="Streetlight">Streetlight</option>
          <option value="Other">Other</option>
        </select>
        <input id="otherCategoryInput" type="text" placeholder="Specify the problem" style="display:none; margin-bottom:12px;">
        <select id="issuePriority" required>
          <option value="">Select Priority</option>
          <option value="Low">Low</option>
          <option value="Medium">Medium</option>
          <option value="High">High</option>
        </select>
        <input id="issueImage" type="file" accept="image/*">
        <p>Select location on map:</p>
        <div id="reportMap"></div>
        <button type="submit" class="btn">Submit Report</button>
      </form>
    </section>

    <!-- ISSUES -->
    <section id="issuesTab" class="tab">
      <h2>Reported Issues</h2>
      <input id="searchInput" type="text" placeholder="Search issues by title, category, or priority">
      <div id="issueList"></div>
    </section>

    <!-- MAP -->
    <section id="mapTab" class="tab">
      <h2>Issue Map</h2>
      <p>View reported issues in Baguio City and La Trinidad.</p>
      <div id="map"></div>
    </section>

    <!-- PROFILE -->
    <section id="profileTab" class="tab">
      <h2>Profile</h2>
      <form id="profileForm">
        <input id="userName" type="text" placeholder="Name" required>
        <input id="userEmail" type="email" placeholder="Email" required>
        <input id="userPhone" type="tel" placeholder="Phone" pattern="^09\d{9}$" required>
        <input id="userAvatar" type="file" accept="image/*">
        <button type="submit" class="btn">Save Profile</button>
      </form>
      <div id="profileDetails" style="display:none;">
        <p><b>Name:</b> <span id="displayName"></span></p>
        <p><b>Email:</b> <span id="displayEmail"></span></p>
        <p><b>Phone:</b> <span id="displayPhone"></span></p>
        <button id="editProfileBtn" class="btn">Edit Profile</button>
      </div>
    </section>
  </div>
</main>

<div id="notification">Issue submitted successfully!</div>

<footer>Â© 2025 Civic Signal | Community Powered Reporting</footer>

<script>
// --- NAVIGATION ---
const navButtons = document.querySelectorAll('.nav-btn');
const tabs = document.querySelectorAll('.tab');
const profileBtn = document.getElementById('profileBtn');
const modeToggle = document.getElementById('modeToggle');

navButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const target = btn.dataset.tab;
    tabs.forEach(t => t.classList.remove('active'));
    navButtons.forEach(b => b.classList.remove('active'));
    document.getElementById(target).classList.add('active');
    btn.classList.add('active');
  });
});

profileBtn.addEventListener('click', () => {
  tabs.forEach(t => t.classList.remove('active'));
  navButtons.forEach(b => b.classList.remove('active'));
  document.getElementById('profileTab').classList.add('active');
});

// --- DARK/LIGHT MODE ---
modeToggle.addEventListener('click', () => {
  document.body.classList.toggle('dark-mode');
  if(document.body.classList.contains('dark-mode')){
    modeToggle.textContent='â˜€ï¸';
    localStorage.setItem('mode','dark');
  } else {
    modeToggle.textContent='ðŸŒ™';
    localStorage.setItem('mode','light');
  }
});

if(localStorage.getItem('mode')==='dark'){
  document.body.classList.add('dark-mode');
  modeToggle.textContent='â˜€ï¸';
}

// --- MAPS ---
let map, reportMap, reportMarker, issueMapMarkers = [];

function initMap() {
  if(!map){
    map = L.map('map').setView([16.4023,120.5960],13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution:'&copy; OpenStreetMap contributors' }).addTo(map);
  }
  map.invalidateSize();
}

function initReportMap() {
  if(!reportMap){
    reportMap = L.map('reportMap').setView([16.4023,120.5960],13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution:'&copy; OpenStreetMap contributors' }).addTo(reportMap);
    reportMap.on('click', e=>{
      if(reportMarker) reportMap.removeLayer(reportMarker);
      reportMarker = L.marker([e.latlng.lat,e.latlng.lng]).addTo(reportMap);
    });
  }
  reportMap.invalidateSize();
}

document.querySelector('[data-tab="mapTab"]').addEventListener('click',()=>setTimeout(()=>initMap(),100));
document.querySelector('[data-tab="reportTab"]').addEventListener('click',()=>setTimeout(()=>initReportMap(),100));

// --- PROFILE ---
const profileForm=document.getElementById('profileForm');
const profileDetails=document.getElementById('profileDetails');
const editProfileBtn=document.getElementById('editProfileBtn');
const userAvatarInput=document.getElementById('userAvatar');

window.onload=()=>{
  const savedProfile=JSON.parse(localStorage.getItem('userProfile'));
  if(savedProfile){
    document.getElementById('displayName').textContent=savedProfile.name;
    document.getElementById('displayEmail').textContent=savedProfile.email;
    document.getElementById('displayPhone').textContent=savedProfile.phone;
    profileDetails.style.display='block';
    updateProfileButton(savedProfile.name,savedProfile.avatar);
  }
}

profileForm.addEventListener('submit', e=>{
  e.preventDefault();
  const name=document.getElementById('userName').value;
  const email=document.getElementById('userEmail').value;
  const phone=document.getElementById('userPhone').value;
  const avatarFile=userAvatarInput.files[0];
  profileForm.style.display='none';
  profileDetails.style.display='block';
  document.getElementById('displayName').textContent=name;
  document.getElementById('displayEmail').textContent=email;
  document.getElementById('displayPhone').textContent=phone;

  if(avatarFile){
    const reader=new FileReader();
    reader.onload=function(e){
      updateProfileButton(name,e.target.result);
      localStorage.setItem('userProfile',JSON.stringify({name,email,phone,avatar:e.target.result}));
    }
    reader.readAsDataURL(avatarFile);
  } else{
    updateProfileButton(name,null);
    localStorage.setItem('userProfile',JSON.stringify({name,email,phone}));
  }
});

editProfileBtn.addEventListener('click', ()=>{
  document.getElementById('userName').value=document.getElementById('displayName').textContent;
  document.getElementById('userEmail').value=document.getElementById('displayEmail').textContent;
  document.getElementById('userPhone').value=document.getElementById('displayPhone').textContent;
  profileForm.style.display='block';
  profileDetails.style.display='none';
});

function updateProfileButton(name,avatarData){
  profileBtn.innerHTML='';
  if(avatarData){
    const img=document.createElement('img');
    img.src=avatarData;
    img.style.objectFit='cover';
    profileBtn.appendChild(img);
  } else if(name){
    const initials=name.split(' ').map(n=>n[0].toUpperCase()).join('').slice(0,2);
    profileBtn.textContent=initials;
  } else profileBtn.textContent='?';
}

// --- ISSUE HANDLING ---
const issueList=document.getElementById('issueList');
const reportFormEl=document.getElementById('reportForm');
const issueCategoryEl=document.getElementById('issueCategory');
const otherCategoryInput=document.getElementById('otherCategoryInput');
const notification=document.getElementById('notification');

// Show extra input if "Other" is selected
issueCategoryEl.addEventListener('change', ()=>{
  if(issueCategoryEl.value==='Other'){
    otherCategoryInput.style.display='block';
    otherCategoryInput.required=true;
  } else{
    otherCategoryInput.style.display='none';
    otherCategoryInput.required=false;
  }
});

reportFormEl.addEventListener('submit', e=>{
  e.preventDefault();
  let category=document.getElementById('issueCategory').value;
  if(category==='Other') category=otherCategoryInput.value || 'Other';
  const title=document.getElementById('issueTitle').value;
  const desc=document.getElementById('issueDesc').value;
  const priority=document.getElementById('issuePriority').value;
  const file=document.getElementById('issueImage').files[0];

  let lat=16.35+Math.random()*0.1;
  let lng=120.57+Math.random()*0.06;
  if(reportMarker){
    lat=reportMarker.getLatLng().lat;
    lng=reportMarker.getLatLng().lng;
    reportMap.removeLayer(reportMarker);
    reportMarker=null;
  }

  const card=document.createElement('div');
  card.classList.add('issue-card');
  card.dataset.title=title.toLowerCase();
  card.dataset.category=category.toLowerCase();
  card.dataset.priority=priority.toLowerCase();

  const content=`<h3>ðŸš§ ${title}</h3>
    <p>${desc}</p>
    <p><b>Category:</b> ${category} | <b>Priority:</b> ${priority}</p>
    <p>Status: <b style="color:var(--danger)">Pending</b></p>
    <div class="comments"></div>
    <input class="commentInput" placeholder="Add a comment"><button class="btn addCommentBtn">Add Comment</button>`;

  if(file){
    const reader=new FileReader();
    reader.onload=function(e){
      const img=document.createElement('img');
      img.src=e.target.result;
      img.style.objectFit='cover';
      card.appendChild(img);
      card.innerHTML+=content;
      addCardFunctions(card);
    }
    reader.readAsDataURL(file);
  } else{
    card.innerHTML=content;
    addCardFunctions(card);
  }

  function addCardFunctions(c){
    const delBtn=document.createElement('button');
    delBtn.textContent='ðŸ—‘ï¸ Delete';
    delBtn.classList.add('delete-btn');
    delBtn.addEventListener('click', ()=> {
      c.remove();
      if(issueMapMarkers.length>0){
        const idx=issueMapMarkers.findIndex(m=>m.card===c);
        if(idx>=0){ map.removeLayer(issueMapMarkers[idx].marker); issueMapMarkers.splice(idx,1);}
      }
    });
    c.appendChild(delBtn);

    const addBtn=c.querySelector('.addCommentBtn');
    addBtn.addEventListener('click', ()=>{
      const input=c.querySelector('.commentInput');
      const commentDiv=c.querySelector('.comments');
      if(input.value.trim()!==''){
        const p=document.createElement('div');
        p.classList.add('comment');
        p.textContent=input.value;
        commentDiv.appendChild(p);
        input.value='';
      }
    });
  }

  issueList.prepend(card);

  if(map){
    const marker=L.marker([lat,lng]).addTo(map);
    marker.bindPopup(`<b>${title}</b><br>Category: ${category}<br>Priority: ${priority}`);
    issueMapMarkers.push({marker,card});
  }

  // Show notification
  notification.style.display='block';
  setTimeout(()=>{ notification.style.display='none'; }, 3000);

  reportFormEl.reset();
  otherCategoryInput.style.display='none';
});
</script>
</body>
</html>
